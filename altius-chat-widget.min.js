(function(){const style = document.createElement('style');style.textContent = `@keyframes pulse{0%,80%,100%{opacity:0.3;transform:scale(0.8);}40%{opacity:1;transform:scale(1);}}#chat-widget{position:fixed;bottom:20px;right:20px;z-index:10000;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;width:350px;height:570px;pointer-events:none;}#chat-button{position:absolute;right:0;bottom:0;width:60px;height:60px;background:#f44336;border-radius:50%;cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,0.15);display:flex;align-items:center;justify-content:center;transition:all 0.3s ease;z-index:3;border:none;padding:0;pointer-events:auto;}#chat-button:hover{transform:scale(1.05);}#chat-button:active{transform:scale(0.95);}#chat-button svg{display:block;}#chat-window{position:absolute;right:0;bottom:70px;width:350px;height:500px;background:white;border-radius:16px;box-shadow:0 8px 30px rgba(0,0,0,0.12);flex-direction:column;overflow:hidden;border:1px solid #e1e8ed;z-index:2;display:none;pointer-events:auto;}#chat-window .header{background:#19c6c2;color:white;padding:16px 20px;display:flex;align-items:center;gap:12px;border-radius:16px 16px 0 0;}#chat-window .header .avatar{width:40px;height:40px;background:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:20px;color:#19c6c2;border:2px solid #e1e8ed;}#chat-window .header .title-text{font-weight:600;font-size:18px;color:#fff;}#chat-close{background:none;border:none;color:white;cursor:pointer;padding:4px;border-radius:4px;opacity:0.8;transition:opacity 0.2s;}#chat-close:hover{opacity:1;}#chat-close:active{transform:scale(0.95);}#chat-messages{flex:1;padding:16px;overflow-y:auto;background:#f8fafd;}#chat-messages::-webkit-scrollbar{width:6px;}#chat-messages::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px;}#chat-messages::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:3px;}#chat-messages::-webkit-scrollbar-thumb:hover{background:#a8a8a8;}.timestamp{text-align:center;margin-bottom:16px;}.timestamp span{font-size:12px;color:#999;background:white;padding:4px 12px;border-radius:12px;display:inline-block;}.system-message{text-align:center;margin-bottom:16px;}.system-message span{font-size:12px;color:#999;}.message{display:flex;margin-bottom:14px;gap:0;}.message .content{flex:1;display:flex;flex-direction:column;align-items:flex-start;}.message.user{justify-content:flex-end;}.message.user .content{align-items:flex-end;}.sender-label{font-size:12px;color:#888;margin-bottom:4px;font-weight:500;}.message .bubble{background:#f0f8ff;border:1px solid #d1e7ff;color:#333;padding:12px 16px 14px 16px;border-radius:18px 18px 18px 4px;font-size:14px;line-height:1.5;max-width:85%;min-width:120px;box-shadow:0 2px 8px rgba(0,0,0,0.06);word-break:break-word;display:flex;flex-direction:column;position:relative;}.message.user .bubble{background:#e6f4ff;border:1px solid #90caf9;color:#222;border-radius:18px 18px 4px 18px;box-shadow:0 2px 8px rgba(144,202,249,0.15);}.message.user .bubble .bubble-time{color:#888;}.message.user .bubble .bubble-content{color:#222;}.bubble-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;font-size:12px;}.bubble-time{font-size:12px;color:#999;margin-left:10px;}.bubble-content{font-size:14px;color:#333;margin-top:0;}.message .avatar{display:none !important;}#loading-indicator{display:flex;gap:8px;margin-bottom:16px;}#loading-indicator .dots{display:flex;gap:4px;align-items:center;}#loading-indicator .dot{width:8px;height:8px;background:#4285f4;border-radius:50%;animation:pulse 1.5s ease-in-out infinite;}#loading-indicator .dot:nth-child(2){animation-delay:0.2s;}#loading-indicator .dot:nth-child(3){animation-delay:0.4s;}.input-area{padding:16px;border-top:1px solid #e9ecef;background:white;}.input-container{display:flex;gap:8px;align-items:center;background:#f8fafd;border-radius:24px;padding:8px 16px;border:1px solid #e1e8ed;}#chat-input{flex:1;border:none;background:none;padding:8px 0;font-size:14px;outline:none;font-family:inherit;color:#333;}#chat-input:focus{border-color:#19c6c2 !important;box-shadow:0 0 0 2px rgba(25,198,194,0.2) !important;}#chat-send{width:36px;height:36px;background:#19c6c2;border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s;flex-shrink:0;}#chat-send:hover{transform:scale(1.05);}#chat-send:active{transform:scale(0.95);}#chat-send:disabled{opacity:0.5;cursor:not-allowed;transform:none !important;}.bubble-initial{font-size:13px;color:#888;font-weight:500;margin-bottom:6px;text-align:left;}`;document.head.appendChild(style);})();(() =>{let isOpen = false;let isLoading = false;const messages = [];const CREATE_SESSION_URL = 'https:const CHAT_URL = 'https:async function ensureSession(){if (!window.session_id || window.session_id === ''){try{const response = await fetch(CREATE_SESSION_URL,{method:'GET',headers:{'qubisa-token-key':window.chat_api_key,},});if (response.ok){const data = await response.json();window.session_id = data.session_id;}else{throw new Error('Failed to create session');}}catch (error){console.error('Error creating session:',error);throw error;}}}async function sendMessage(message){await ensureSession();try{const response = await fetch(CHAT_URL,{method:'POST',headers:{'Content-Type':'application/json','qubisa-token-key':window.chat_api_key,},body:JSON.stringify({session_id:window.session_id,prompt:message,user_profile:window.personal_data,}),});if (response.ok){const data = await response.json();return data.response;}else{throw new Error('Failed to send message');}}catch (error){console.error('Error sending message:',error);return 'Maaf,terjadi kesalahan. Silakan coba lagi.';}}function createWidget(){const widgetHTML = ` <div id="chat-widget"> <div id="chat-window"> <div class="header"> <div class="avatar">V</div> <div class="title"> <div class="title-text">Digital Assistant</div> </div> </div> <div id="chat-messages"></div> <div class="input-area"> <div class="input-container"> <input id="chat-input" type="text" placeholder="Type here..." /> <button id="chat-send" disabled> <svg width="16" height="16" viewBox="0 0 24 24" fill="white"> <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/> </svg> </button> </div> </div> </div> <div id="chat-button"> <span id="icon-chat" style="display:block;"> <svg width="48" height="48" viewBox="0 0 48 48" fill="none"> <circle cx="24" cy="24" r="24" fill="#F44336"/> <path d="M34 16a2 2 0 0 0-2-2H16a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10l4 4v-4h2a2 2 0 0 0 2-2V16z" fill="white"/> <rect x="18" y="20" width="12" height="2" rx="1" fill="#F44336"/> <rect x="18" y="24" width="8" height="2" rx="1" fill="#F44336"/> </svg> </span> <span id="icon-close" style="display:none;"> <svg width="48" height="48" viewBox="0 0 48 48" fill="none"> <circle cx="24" cy="24" r="24" fill="#F44336"/> <path d="M16 16L32 32M32 16L16 32" stroke="white" stroke-width="3" stroke-linecap="round"/> </svg> </span> </div> </div> `;document.body.insertAdjacentHTML('beforeend',widgetHTML);addMessage( 'Halo! Saya adalah asisten virtual AI anda. ada yang bisa saya bantu ?',false,true );}function addMessage(message,isUser = false,initial = false){const messagesContainer = document.getElementById('chat-messages');const senderName = isUser ? 'You':'Assistant';const time = new Date().toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit',});const bubbleHeader = `<div class=\"bubble-header\"><span class=\"sender-label\">${senderName}</span><span class=\"bubble-time\">${time}</span></div>`;const bubbleContent = `<div class=\"bubble-content\">${message}</div>`;const messageHTML = ` <div class=\"message${isUser ? ' user':''}\"> <div class=\"bubble\"> ${bubbleHeader}${bubbleContent}</div> </div> `;messagesContainer.insertAdjacentHTML('beforeend',messageHTML);messagesContainer.scrollTop = messagesContainer.scrollHeight;}function addLoadingIndicator(){const messagesContainer = document.getElementById('chat-messages');const loadingHTML = ` <div id="loading-indicator"> <div class="content"> <div class="bubble"> <div class="dots"> <div class="dot"></div> <div class="dot"></div> <div class="dot"></div> </div> </div> </div> </div> `;messagesContainer.insertAdjacentHTML('beforeend',loadingHTML);messagesContainer.scrollTop = messagesContainer.scrollHeight;}function removeLoadingIndicator(){const loadingIndicator = document.getElementById('loading-indicator');if (loadingIndicator){loadingIndicator.remove();}}async function handleSendMessage(){const input = document.getElementById('chat-input');const sendButton = document.getElementById('chat-send');const message = input.value.trim();if (!message || isLoading) return;addMessage(message,true);input.value = '';isLoading = true;sendButton.disabled = true;addLoadingIndicator();try{const response = await sendMessage(message);removeLoadingIndicator();addMessage(response);}catch (error){removeLoadingIndicator();addMessage('Maaf,terjadi kesalahan. Silakan coba lagi.');}finally{isLoading = false;sendButton.disabled = false;}}function toggleChat(){const chatWindow = document.getElementById('chat-window');const iconChat = document.getElementById('icon-chat');const iconClose = document.getElementById('icon-close');isOpen = !isOpen;chatWindow.style.display = isOpen ? 'flex':'none';iconChat.style.display = isOpen ? 'none':'block';iconClose.style.display = isOpen ? 'block':'none';if (isOpen){setTimeout(() =>{document.getElementById('chat-input').focus();},100);}}function init(){if (!window.chat_api_key){console.error('Altius Chat Widget:chat_api_key is required');return;}if (!window.personal_data){console.error('Altius Chat Widget:personal_data is required');return;}createWidget();document .getElementById('chat-button') .addEventListener('click',toggleChat);document .getElementById('chat-send') .addEventListener('click',handleSendMessage);const input = document.getElementById('chat-input');const sendButton = document.getElementById('chat-send');input.addEventListener('input',function (){sendButton.disabled = !this.value.trim() || isLoading;});input.addEventListener('keypress',e =>{if (e.key === 'Enter' && !e.shiftKey){e.preventDefault();handleSendMessage();}});console.log('Altius Chat Widget initialized successfully');}if (document.readyState === 'loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}})();